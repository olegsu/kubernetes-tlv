version: '1.0'
steps:

  strict_to_production:
    title: Reading production version
    image: codefresh/kube-helm:master
    commands:
    - ./bin/read-production-version.sh
    when:
      branch:
        only:
          - master

  install_chart:
    title: Installing chart
    image: codefresh/cli
    commands:
    - sh bin/install-chart.sh


  test_release:
    title: Testing release
    image: codefresh/cli
    commands:
    - sh bin/test-release.sh
    when:
      condition:
        any:
          prOpened: '"${{CF_PULL_REQUEST_ACTION}}" == "opened"'
          prReOpened: '"${{CF_PULL_REQUEST_ACTION}}" == "reopened"'